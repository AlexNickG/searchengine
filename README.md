# Search Engine Project
### Дипломная работа по созданию локального поискового движка по сайтам 

Проект разработан на языке Java с использованием фреймворка Spring Boot Framework, а также библиотек лемматизаторов.

Приложение имеет несколько режимов работы:
- индексация по выбранным сайтам (также возможно добавление в индекс отдельных страниц);
- поиск по индексу по ключевым словам.

## Содержание
* [Основные функции](#основные-функции)
* [Технологии](#Технологии)
* [Структура проекта](#Структура-проекта)
* [Настройки для запуска](#Настройки-для-запуска)
* [Запуск приложения](#Запуск-приложения)

## Основные функции

- **Индексация веб-страниц**:
  - Поиск и сохранение структуры страниц.
  - Работа с обработкой ссылок и документов.
  - Многопоточное выполнение для повышения производительности.
- 
- **Работа с БД**:
  - Хранение информации о сайтах, страницах, леммах и индексах.
  - Поддержка операций для очистки или обновления данных.
  - Поиск по базе данных и выдача результатов поиска.
- 
- **Поиск**:
  - Обработка запросов пользователей.
  - Использование лемматизации для улучшения качества поисковых запросов.

## Технологии

- **Язык программирования**: Java 17
- **Фреймворк**: Spring Boot
- **Используемые библиотеки**:
  - `Slf4j` для логирования.
  - Работа с потоками: `ForkJoinTask`, `ExecutorService`.
  - Java Collections (`ConcurrentSkipListSet`, `AtomicInteger` и др.).

- **Базы данных**:
  - Сущности подключены через JPA (репозитории).
  - Таблицы базы данных создаются автоматически при запуске приложения при помощи Liquibase.

## Архитектура приложения
Проект построен в соответствии с моделью MVC (Model-View-Controller), что позволяет разделить логику приложения на слои 
и сделать код более чистым и поддерживаемым.
В нашем случае есть три слоя:

* **Presentation** - Контроллеры. слой общается с пользователями, в нашем случае ожидает запросы по API и отдает
  ответы пользователю.
* **Controller - Business** - Бизнес логика, содержится в классах сервисов. Этот слой ничего не знает о Presentation слое.
  Сервисы реализуют бизнес логику приложения, обрабатывают данные, выполняют расчеты и проверки. Сервисы могут
  взаимодействовать с другими сервисами, но не с контроллерами напрямую.
* **Data Access** - слой отвечает за хранение данных, подключение к БД, реализацию запросов. Слой не знает о других
  слоях ничего. У нас это классы Репозитории.

Если посмотреть слои данного приложения, то увидим не только сами классы, но еще и интерфейсы между ними.

Интерфейсы нужны, чтобы слои приложения не зависели от реализаций классов. Каждый из классов-сервисов, такие, как IndexingServiceImpl,  
SearchServiceImpl зависят от соответствующих интерфейсов. Это значит, что сервисы и контроллеры могут меняться
независимо, заменяться и это не будет влиять на другие слои.

Также это относится и к передаваемым данным, у каждого слоя
может быть свои структуры для хранения данных, например Репозитории отдают Entity классы, а сервисы уже упаковывают в
нужные объекты, снова для того, чтобы конечный потребитель данных не зависел напрямую от структуры данных в БД. БД может
измениться, поменять структуру таблиц - и это должно произойти максимально незаметно для других слоев.

## Структура проекта
- **`searchengine.services`**:
  - Основной пакет с реализацией логики индексации и поиска.
  - Классы:
    - `IndexingServiceImpl` — отвечает за индексацию страниц, организацию потоков, работу с базой.
    - `LemmaFinder` — выполняет лемматизацию текста.
    - `SearchServiceImpl` — обработка пользовательских поисковых запросов.
    - `StatisticsServiceImpl` - предоставляет статистику по индексированным сайтам и страницам.

- **`searchengine.repositories`**:
  - Отвечает за работу с базой данных:
    - `IndexRepository` — хранение данных об индексах.

- **Ключевые конфигурации**:
  - `application.yaml` — хранит настройки подключения, включая параметры индексации (`userAgent`, `referrer`, `timeout`).
## Основные классы и их функционал

### **`IndexingServiceImpl`**
Реализует логику индексации:
- Многопоточная обработка (с использованием `ExecutorService` и потоков).
- Методы:
  - `startIndexing()` — запускает процесс индексации.
  - `stopIndexing()` — завершает текущую индексацию.
  - `addPageForIndexing(String url)` — добавляет отдельные страницы в индекс.
  - `clearDb()` — очищает базу данных.

### **`LemmaFinder`**
- Реализует лемматизацию текста, улучшая точность работы поисковой системы.
### **`SearchServiceImpl`**
- Обрабатывает поисковые запросы пользователей.
- ### **`StatisticsServiceImpl`**
- Предоставляет статистику по индексированным сайтам и страницам.
## Настройки для запуска
В файле настроек проекта application.yaml в разделе 
```yaml
indexing-settings: 
  sites:
```
задается перечень сайтов для
индексации.
Параметр
```yaml
clearDb:
```
определяет, нужно ли очищать базу данных перед индексацией.
В разделе
```yaml
search-settings:
  searchFilter:
  ```
параметром searchFilter можно отфильтровывать из результатов поиска слишком часто встречающиеся слова из поискового запроса. 
По умолчанию параметр равен 90, это значит, что все слова из поискового запроса, которые встречаются на 90% и более страниц сайта 
будут отфильтрованы из результатов поиска.

Также, в разделе 
```yaml
exceptions:
  ```
можно задавать расширения файлов и пути, содержащие заданные символы, которые не будут индексироваться. 
### Настройки подключения к БД

В проект добавлен драйвер для подключения к БД PostgreSQL. Для запуска проекта
убедитесь, что у вас запущен сервер PostgreSQL.

Создайте бд `search_engine` и замените логин и пароль в файле конфигурации `application.yaml`:

```yaml
spring:
  datasource:
    username: # имя пользователя
    password: # пароль пользователя
```
В разделе connection-settings файла application.yaml есть параметр
timeout (по умолчанию равен 550 мс), который можно увеличить,
если индексируемый сайт блокирует подключение из-за слишком частых запросов.
После этого, можете запустить проект. Если введены правильные данные,
проект успешно запустится. Если запуск заканчивается ошибками, изучите текст
ошибок, внесите исправления и попробуйте заново.

## Запуск приложения
В папке приложения выполните команду:
```shell
java -jar search-engine-0.0.1-SNAPSHOT.jar
```
После запуска приложения, перейдите в браузере по адресу `http://localhost:8080/` для доступа к интерфейсу поиска.
При работе приложения в подпапке logs проекта создаются лог-файлы логов stderr.log и stdinfo.log, в которых можно найти информацию о процессе работы приложения.








